%web_drop_table(WORK.QUERY);

/**************************************************************************/
/*  ENADE2014 - Consulta SQL a Base: MICRODADOS_ENEM_2014.csv 			  */     
/*	Desenvolvido por: Patrick Guerra            	  					  */
/*  Formato do script: sql/sas 											  */ 
/**************************************************************************/

PROC SQL; 
CREATE TABLE WORK.QUERY 
AS 
SELECT 
	TP_SEXO, 
	IDADE, 
	(CASE WHEN (
	/* Validacao das Regras de emissao de certificado atraves do ENEM*/
		NU_NOTA_REDACAO >=500 AND
		NOTA_CN >= 450 AND
		NOTA_CH >= 450 AND
		NOTA_LC >= 450 AND
		NOTA_MT >= 450) 
		/* Caso todas as condicoes forem verdadeiras return 1 else 0*/
			THEN "Sim" 
			ELSE "Nao" 
	END)
	AS CERTIFICADO_EMITIDO,

	(CASE 
		WHEN ( ID_DEPENDENCIA_ADM_ESC LIKE "1") THEN "Federal" 
		WHEN ( ID_DEPENDENCIA_ADM_ESC LIKE "2") THEN "Estadual"
		WHEN ( ID_DEPENDENCIA_ADM_ESC LIKE "3") THEN "Municipal"
	    WHEN ( ID_DEPENDENCIA_ADM_ESC LIKE "4") THEN "Privada"
	END)
	AS ID_DEPENDENCIA_ADM_ESC,

	(CASE 
		WHEN (TP_ESCOLA LIKE "1") THEN "Publica"
		WHEN (TP_ESCOLA LIKE "2") THEN "Privada"
	END)
	AS TP_ESCOLA,

	(CASE 
		WHEN (ID_LOCALIZACAO_ESC = "1") THEN "Urbana"
		WHEN (ID_LOCALIZACAO_ESC = "2") THEN "Rural"
	END)
	AS ID_LOCALIZACAO_ESC,

	(CASE 
		WHEN ( IN_TP_ENSINO LIKE "1") 
			THEN "Ensino_Regular" 
		WHEN ( IN_TP_ENSINO LIKE "2") 
			THEN "Ensino_de_Jovens_e_Adultos"
	    WHEN ( IN_TP_ENSINO LIKE "4") 
	    	THEN "Ensino_Especial"
	END)
	AS IN_TP_ENSINO,

	(CASE
		WHEN (Q003 LIKE "A" OR Q003 LIKE "B" OR Q003 LIKE "C" OR Q003 LIKE "D") 
			THEN "E"  
		WHEN (Q003 LIKE "E" OR Q003 LIKE "F" OR Q003 LIKE "G") 
			THEN "D" 
		WHEN (Q003 LIKE "H" OR Q003 LIKE "I" OR Q003 LIKE "J" OR Q003 LIKE "K" OR Q003 LIKE "L" OR Q003 LIKE "M") 
			THEN "C" 
		WHEN (Q003 LIKE "N" OR Q003 LIKE "O" OR Q003 LIKE "P") 
			THEN "B" 
		WHEN (Q003 LIKE "Q") 
			THEN "A" 
	END)
	AS CLASSE_SOCIAL_RENDA_MENSAL
 
FROM ENEM2014.DADOS_ENEM_2014 DADOS_ENEM_2014 

WHERE
/* Valores em Branco ou Nulos nao devem ser considerados */
	DADOS_ENEM_2014.TP_SEXO IS NOT NULL AND
	DADOS_ENEM_2014.IDADE IS NOT NULL AND
	DADOS_ENEM_2014.TP_ESCOLA IS NOT NULL AND
	DADOS_ENEM_2014.IN_CERTIFICADO IS NOT NULL AND
	DADOS_ENEM_2014.ID_LOCALIZACAO_ESC IS NOT NULL AND
	DADOS_ENEM_2014.ID_DEPENDENCIA_ADM_ESC IS NOT NULL AND
	DADOS_ENEM_2014.NACIONALIDADE IS NOT NULL AND
	DADOS_ENEM_2014.ST_CONCLUSAO IS NOT NULL AND
	DADOS_ENEM_2014.IN_TP_ENSINO IS NOT NULL AND
	DADOS_ENEM_2014.NOTA_CN IS NOT NULL AND
	DADOS_ENEM_2014.NOTA_CH IS NOT NULL AND
	DADOS_ENEM_2014.NOTA_LC IS NOT NULL AND
	DADOS_ENEM_2014.NOTA_MT IS NOT NULL AND
	DADOS_ENEM_2014.IN_STATUS_REDACAO IS NOT NULL AND
	DADOS_ENEM_2014.NU_NOTA_REDACAO IS NOT NULL AND
/* Questionario Socioeconomico  */
	DADOS_ENEM_2014.Q001 IS NOT NULL AND
	DADOS_ENEM_2014.Q002 IS NOT NULL AND
	DADOS_ENEM_2014.Q003 IS NOT NULL AND
	DADOS_ENEM_2014.Q004 IS NOT NULL AND
	DADOS_ENEM_2014.Q005 IS NOT NULL AND
	DADOS_ENEM_2014.Q006 IS NOT NULL AND
	DADOS_ENEM_2014.Q007 IS NOT NULL AND
	DADOS_ENEM_2014.Q008 IS NOT NULL AND
	DADOS_ENEM_2014.Q009 IS NOT NULL AND
	DADOS_ENEM_2014.Q010 IS NOT NULL AND
	DADOS_ENEM_2014.Q011 IS NOT NULL AND
	DADOS_ENEM_2014.Q012 IS NOT NULL AND
	DADOS_ENEM_2014.Q013 IS NOT NULL AND
	DADOS_ENEM_2014.Q014 IS NOT NULL AND
	DADOS_ENEM_2014.Q015 IS NOT NULL AND
	DADOS_ENEM_2014.Q016 IS NOT NULL AND
	DADOS_ENEM_2014.Q017 IS NOT NULL AND
	DADOS_ENEM_2014.Q018 IS NOT NULL AND
	DADOS_ENEM_2014.Q019 IS NOT NULL AND
	DADOS_ENEM_2014.Q020 IS NOT NULL AND
	DADOS_ENEM_2014.Q021 IS NOT NULL AND
	DADOS_ENEM_2014.Q022 IS NOT NULL AND
	DADOS_ENEM_2014.Q023 IS NOT NULL AND
	DADOS_ENEM_2014.Q024 IS NOT NULL AND
	DADOS_ENEM_2014.Q025 IS NOT NULL AND
	DADOS_ENEM_2014.Q026 IS NOT NULL AND
	DADOS_ENEM_2014.Q027 IS NOT NULL AND
	DADOS_ENEM_2014.Q028 IS NOT NULL AND
	DADOS_ENEM_2014.Q029 IS NOT NULL AND
	DADOS_ENEM_2014.Q030 IS NOT NULL AND
	DADOS_ENEM_2014.Q031 IS NOT NULL AND
	DADOS_ENEM_2014.Q032 IS NOT NULL AND
	DADOS_ENEM_2014.Q033 IS NOT NULL AND
	DADOS_ENEM_2014.Q034 IS NOT NULL AND
	DADOS_ENEM_2014.Q035 IS NOT NULL AND
	DADOS_ENEM_2014.Q036 IS NOT NULL AND
	DADOS_ENEM_2014.Q037 IS NOT NULL AND
	DADOS_ENEM_2014.Q038 IS NOT NULL AND
	DADOS_ENEM_2014.Q039 IS NOT NULL AND
	DADOS_ENEM_2014.Q040 IS NOT NULL AND
	DADOS_ENEM_2014.Q041 IS NOT NULL AND
	DADOS_ENEM_2014.Q042 IS NOT NULL AND
	DADOS_ENEM_2014.Q043 IS NOT NULL AND
	DADOS_ENEM_2014.Q044 IS NOT NULL AND
	DADOS_ENEM_2014.Q045 IS NOT NULL AND
	DADOS_ENEM_2014.Q046 IS NOT NULL AND
	DADOS_ENEM_2014.Q047 IS NOT NULL AND
	DADOS_ENEM_2014.Q048 IS NOT NULL AND
	DADOS_ENEM_2014.Q049 IS NOT NULL AND
	DADOS_ENEM_2014.Q050 IS NOT NULL AND
	DADOS_ENEM_2014.Q051 IS NOT NULL AND
	DADOS_ENEM_2014.Q052 IS NOT NULL AND
	DADOS_ENEM_2014.Q053 IS NOT NULL; 
QUIT;

%web_open_table(WORK.QUERY);